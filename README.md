# 🏆 EduBattle — Сайт для подготовки к олимпиадам с механикой онлайн-боёв

![Version](https://img.shields.io/badge/version-1.0.7-blue)
![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20Linux-lightgrey)
![License](https://img.shields.io/badge/license-MIT-green)

> Платформа для подготовки к олимпиадам с системой онлайн-баттлов, марафонами, турнирами по расписанию, AI-генерацией задач и двухфакторной верификацией через Telegram.

---

## 📋 Оглавление

- [Описание проекта](#-описание-проекта)
- [Возможности](#-возможности)
- [Системные требования](#-системные-требования)
- [Установка и запуск (Windows)](#-установка-и-запуск-windows)
- [Установка и запуск (Linux)](#-установка-и-запуск-linux)
- [Настройка переменных окружения](#️-настройка-переменных-окружения)
- [Доступ к сайту](#-доступ-к-сайту)
- [Панель администратора](#-панель-администратора)
- [Марафоны и турниры](#-марафоны-и-турниры)
- [Расширенная панель администратора](#-расширенная-панель-администратора)
- [Telegram-бот @syndver\_bot](#-telegram-бот-syndver_bot)
- [Управление пользователями](#-управление-пользователями)
- [Структура проекта](#-структура-проекта)
- [FAQ](#-faq)

---

## 📖 Описание проекта

**EduBattle** — это веб-платформа для подготовки к олимпиадам, которая предоставляет:

- Каталог олимпиадных задач с возможностью решения
- Систему **онлайн-боёв** между участниками в реальном времени
- Проведение **марафонов** и **турниров** по расписанию
- AI-генерацию задач
- Двухфакторную верификацию администраторов через Telegram
- Расширенную панель управления с прямым доступом к базе данных

---

## ✨ Возможности

| Функция | Описание |
|---|---|
| 🎯 **Решение задач** | Каталог олимпиадных задач по категориям и сложности |
| ⚔️ **Онлайн-бои** | Соревнования между участниками в реальном времени |
| 🏃 **Марафоны** | Длительные соревнования с серией задач по расписанию |
| 🏟️ **Турниры** | Турниры с сеткой, раундами и автоматическим расписанием |
| 🤖 **AI-генерация** | Автоматическая генерация задач с помощью ИИ |
| 📊 **Импорт задач** | Загрузка задач через JSON и CSV |
| 🔐 **2FA через Telegram** | Двухфакторная верификация для администраторов |
| 🛡️ **Панель администратора** | Управление пользователями, задачами, событиями и контентом |
| 📈 **Расширенная панель** | Полный доступ к базе данных и продвинутые инструменты |

---

## 💻 Системные требования

### Windows

- **ОС:** Windows 10 / 11 (64-bit)
- **ОЗУ:** минимум 4 ГБ
- **Свободное место:** 500 МБ
- **Интернет-соединение** (для работы Telegram-бота)
- **Аккаунт Telegram** (для администрирования)

### Linux

- **ОС:** Ubuntu 20.04+ / Debian 11+ / Fedora 36+ или аналогичный дистрибутив
- **Python:** 3.12
- **ОЗУ:** минимум 4 ГБ
- **Свободное место:** 500 МБ
- **Интернет-соединение** (для работы Telegram-бота)
- **Аккаунт Telegram** (для администрирования)

---

## 🪟 Установка и запуск (Windows)

### Шаг 1: Скачайте архив

Перейдите в раздел [Releases](../../releases) и скачайте папку **`olimp_win`**.

Архив содержит:
```
olimp_win/
├── olimp_server.exe          # Основной исполняемый файл
├── database.db               # База данных с тестовыми данными
├── db_editor.exe             # Редактор базы данных
├── tasks/                    # Комплект олимпиадных задач
│   ├── tasks.json
│   └── tasks.csv
└── README.txt                # Краткая инструкция
```

### Шаг 2: Распакуйте архив

Распакуйте `olimp_win` в **любую папку** на вашем компьютере.

> ⚠️ **Важно:** Путь к папке не должен содержать кириллические символы.
> - ✅ `C:\Projects\olimp_win\`
> - ❌ `C:\Мои проекты\олимпиада\`

### Шаг 3: Установите переменную окружения

См. раздел [Настройка переменных окружения](#️-настройка-переменных-окружения).

### Шаг 4: Запуск

Откройте командную строку в папке с распакованными файлами:

```cmd
set MAIN_ADMIN_TG_ID=123456789
olimp_server.exe
```

Или, если переменная установлена через системные настройки — просто запустите **`olimp_server.exe`** двойным кликом.

---

## 🐧 Установка и запуск (Linux)

### Шаг 1: Скачайте архив

Перейдите в раздел [Releases](../../releases) и скачайте папку **`olimp_lin`**.

Содержимое:
```
olimp_lin/
├── db_editor              # Редактор базы данных
├── tasks                  # Тестовые задачи
├── database.db            # База данных с тестовыми данными
├── db_helper.py           # Вспомогательный модуль для работы с БД
├── index.html             # Главная страница верификации
├── launcher.py            # Скрипт запуска серверов
├── paths.py               # Конфигурация путей
├── requirements.txt       # Зависимости Python
└── server.py              # Основной серверный модуль
```

### Шаг 2: Распакуйте и перейдите в папку

```bash
cd ~/Downloads/olimp_lin
```

### Шаг 3: Установите зависимости

```bash
pip install -r requirements.txt
```

> ⚠️ **Если установка через файл не работает**, установите зависимости вручную. Откройте `requirements.txt`, посмотрите список пакетов и установите каждый отдельно:
>
> ```bash
> pip install flask
> pip install fastapi
> pip install aiogram
> # ... и так далее для каждого пакета из requirements.txt
> ```
>
> Если `pip` не найден, попробуйте `pip3`:
> ```bash
> pip3 install -r requirements.txt
> ```

### Шаг 4: Установите переменную окружения

```bash
export MAIN_ADMIN_TG_ID=123456789
```

> ⚠️ **Если переменная окружения не будет установлена, будет использоваться Telegram ID по умолчанию.** Настоятельно рекомендуется указать свой ID для корректной работы системы администрирования.

Для постоянной установки добавьте строку в `~/.bashrc` или `~/.profile`:

```bash
echo 'export MAIN_ADMIN_TG_ID=123456789' >> ~/.bashrc
source ~/.bashrc
```

### Шаг 5: Выдайте права на исполнение (при необходимости)

```bash
chmod +x db_editor
chmod +x launcher.py
chmod +x server.py
```

### Шаг 6: Запуск

```bash
python3 launcher.py
```

После запуска поднимутся **два сервера**:

| Сервер | Адрес | Назначение |
|---|---|---|
| **Основной сайт** | [http://localhost:8080](http://localhost:8080) | Сайт олимпиады |
| **Панель верификации** | [http://localhost:5000](http://localhost:5000) | Расширенная админ-панель |

---

## ⚙️ Настройка переменных окружения

Перед запуском необходимо установить переменную окружения `MAIN_ADMIN_TG_ID`.

### Как узнать ваш Telegram ID

| Способ | Описание |
|---|---|
| **Способ 1** | Откройте в Telegram бота **[@funstat](https://t.me/funstat)** (сторонний ресурс) — бот отобразит ваш ID |
| **Способ 2** | Откройте нашего бота **[@syndver_bot](https://t.me/syndver_bot)** — бот для двухфакторной верификации этой олимпиады |

### Windows

#### Временно (на одну сессию CMD):
```cmd
set MAIN_ADMIN_TG_ID=123456789
```

#### Временно (на одну сессию PowerShell):
```powershell
$env:MAIN_ADMIN_TG_ID = "123456789"
```

#### Постоянно (через системные настройки):
1. Нажмите `Win + R` → введите `sysdm.cpl` → Enter
2. Вкладка **«Дополнительно»** → **«Переменные среды…»**
3. В блоке **«Переменные среды пользователя»** → **«Создать»**
4. **Имя:** `MAIN_ADMIN_TG_ID` | **Значение:** `ваш_telegram_id`
5. **«ОК»** во всех окнах

### Linux

#### Временно (на одну сессию):
```bash
export MAIN_ADMIN_TG_ID=123456789
```

#### Постоянно:
```bash
echo 'export MAIN_ADMIN_TG_ID=123456789' >> ~/.bashrc
source ~/.bashrc
```

> 📌 Замените `123456789` на ваш реальный Telegram ID.

> ⚠️ **Linux:** Если переменная не будет установлена, сервер запустится с ID по умолчанию. Функции суперадмина в Telegram-боте будут недоступны или привязаны к тестовому аккаунту.

---

## 🌐 Доступ к сайту

Откройте браузер и перейдите по адресу:

```
http://localhost:8080
```

Здесь доступен весь функционал платформы:
- Регистрация и авторизация участников
- Каталог олимпиадных задач
- Система онлайн-боёв
- Марафоны и турниры
- Личный кабинет и статистика
- Панель администратора

---

## 🔧 Панель администратора

### Вход в базовую панель администратора

На сайте `http://localhost:8080` выполните вход с тестовыми данными:

| Поле | Значение |
|---|---|
| **Email** | `admin@edu.ru` |
| **Пароль** | `admin123` |

После входа вы получите доступ к базовой панели администратора:
- Модерация задач
- Просмотр статистики пользователей
- Управление соревнованиями, боями, марафонами и турнирами
- Настройки платформы

---

## 🏃 Марафоны и турниры

Платформа поддерживает проведение **марафонов** и **турниров** по расписанию.

### Что такое марафон?

Марафон — это длительное соревнование (от нескольких часов до нескольких дней), в котором участники последовательно решают серию задач. Марафоны имеют фиксированное время начала и окончания.

### Что такое турнир?

Турнир — это соревнование с сеткой и раундами. Участники проходят через серию боёв, где победители переходят в следующий раунд.

### Создание марафона или турнира

1. Войдите в **панель администратора** на `http://localhost:8080` с тестовыми данными
2. Перейдите в раздел **«Марафоны и турниры»** в меню навигации
3. В **верхнем правом углу** нажмите кнопку **«Добавить событие»**
4. Заполните форму создания:

| Поле | Описание |
|---|---|
| **Название** | Название марафона или турнира |
| **Тип** | Марафон / Турнир |
| **Дата начала** | Дата и время старта |
| **Дата окончания** | Дата и время завершения |
| **Описание** | Подробное описание события |
| **Задачи** | Выбор задач из каталога или автогенерация |
| **Ограничения** | Максимальное число участников, уровень сложности и др. |

5. Нажмите **«Создать событие»**

> 💡 После создания событие появится в расписании на главной странице сайта. Участники смогут зарегистрироваться на него заранее.

### Управление событиями

В разделе **«Марафоны и турниры»** администратор может:
- 📅 Просматривать расписание всех предстоящих и прошедших событий
- ✏️ Редактировать параметры событий
- 🚫 Отменять или приостанавливать события
- 📊 Просматривать результаты и рейтинги участников
- 🏆 Формировать итоговые таблицы победителей

---

## 🔐 Расширенная панель администратора

Расширенная панель предоставляет продвинутые инструменты: AI-генерацию задач, импорт данных, прямой доступ к БД. Доступ осуществляется через **двухфакторную верификацию в Telegram**.

### Пошаговая инструкция

#### Этап 1: Настройка суперадмина в Telegram-боте

1. Убедитесь, что переменная `MAIN_ADMIN_TG_ID` установлена и сервер запущен
2. Откройте Telegram и перейдите в бота **[@syndver_bot](https://t.me/syndver_bot)**
3. В личном чате с ботом появится **интерфейс главного администратора (суперадмина)**

> 💡 Интерфейс суперадмина появляется автоматически у аккаунта, чей Telegram ID указан в переменной `MAIN_ADMIN_TG_ID`.

#### Этап 2: Регистрация администратора

В панели суперадмина в Telegram-боте:

1. Нажмите кнопку **«Добавить администратора»**
2. Зарегистрируйте аккаунт — бот выдаст вам **4-значный идентификатор аккаунта**

> 📝 **Запишите этот 4-значный код** — он понадобится на следующем этапе.

> ⚠️ **Важно:** Для следующего шага вам потребуется **второй аккаунт Telegram**, либо зарегистрируйте ID суперадмина в списке администраторов через панель суперадмина в боте — тогда вы сможете получить код входа с того же аккаунта.

#### Этап 3: Получение 16-значного кода верификации

1. Зайдите **с другого аккаунта Telegram** (или с основного, если вы добавили его в список) в бота **[@syndver_bot](https://t.me/syndver_bot)**
2. Нажмите кнопку **«Получить ключ входа»** (или **«Войти в систему»**)
3. Бот попросит ввести **4-значный код** — введите код, полученный при регистрации на Этапе 2
4. Далее бот попросит ввести **данные админ-аккаунта**:

| Поле | Значение |
|---|---|
| **Email** | `admin@edu.ru` |
| **Никнейм** | `Admin` |

5. После успешного выполнения всех шагов бот отправит вам **16-значный код верификации**

#### Этап 4: Вход в расширенную панель

1. Откройте в браузере:
   ```
   http://localhost:5000
   ```
2. На главной странице введите полученный **16-значный код верификации**
3. Нажмите **«Войти»**

> ⚠️ **Код одноразовый!** После использования он становится недействительным. Для повторного входа потребуется получить новый код через бота.

### Возможности расширенной панели

| Функция | Описание |
|---|---|
| 🤖 **AI-генерация задач** | Автоматическое создание олимпиадных задач с помощью ИИ |
| 📥 **Импорт из JSON** | Загрузка задач из JSON-файлов |
| 📥 **Импорт из CSV** | Загрузка задач из CSV-файлов |
| 🗃️ **Просмотр БД** | Просмотр всех таблиц базы данных |
| ✏️ **Редактирование БД** | Редактирование записей напрямую в базе данных |

---

## 🤖 Telegram-бот @syndver_bot

Бот **[@syndver_bot](https://t.me/syndver_bot)** выполняет несколько функций:

### Для суперадмина (владелец `MAIN_ADMIN_TG_ID`):
- 👑 Управление списком администраторов
- ➕ Добавление / удаление доступа к панели администратора
- 📊 Просмотр активных сессий

### Для администраторов:
- 🔑 Получение одноразовых 16-значных кодов для входа в расширенную панель
- 🔔 Уведомления о событиях на платформе

### Для обычных пользователей:
- 🆔 Получение своего Telegram ID
- ℹ️ Информация о платформе

---

## 👥 Управление пользователями

### Бан пользователя

Для блокировки пользователя:

1. Войдите в **расширенную панель администратора** (`http://localhost:5000`)
2. Откройте раздел **«Просмотр таблиц БД»**
3. Выберите таблицу **«Пользователи»** (Users)
4. Найдите нужного пользователя
5. В графе **`is_active`** измените значение с `1` на **`0`**
6. Сохраните изменения

| Значение `is_active` | Статус |
|---|---|
| `1` | ✅ Пользователь активен |
| `0` | 🚫 Пользователь заблокирован |

> 💡 Для разблокировки измените значение `is_active` обратно на `1`.

Также можно использовать **встроенный редактор базы данных** (`db_editor.exe` на Windows / `db_editor` на Linux) из комплекта поставки.

---

## 📁 Структура проекта

### Windows (`olimp_win`)

```
olimp_win/
├── olimp_server.exe          # Главный исполняемый файл
├── database.db               # SQLite база данных
├── db_editor.exe             # Редактор базы данных
├── tasks/                    # Комплект олимпиадных задач
│   ├── tasks.csv
│   ├── tasks.json
└── README.txt
```

### Linux (`olimp_lin`)

```
olimp_lin/
├── launcher.py               # Скрипт запуска серверов
├── server.py                 # Основной серверный модуль
├── db_helper.py              # Вспомогательный модуль для работы с БД
├── paths.py                  # Конфигурация путей
├── database.db               # SQLite база данных
├── db_editor                 # Редактор базы данных
├── index.html                # Главная страница верификации
└── requirements.txt          # Зависимости Python
```

---

## 📊 Схема работы системы

```
┌──────────────────────────────────────────────────────────────┐
│              olimp_server.exe / launcher.py                    │
│                                                                │
│   ┌──────────────────────────┐   ┌───────────────────────────┐│
│   │     Основной сайт        │   │   Расширенная панель      ││
│   │     localhost:8080        │   │   localhost:5000           ││
│   │                          │   │                           ││
│   │  • Каталог задач         │   │  • AI-генерация задач    ││
│   │  • Онлайн-бои           │   │  • Импорт JSON/CSV       ││
│   │  • Марафоны и турниры   │   │  • Просмотр таблиц БД    ││
│   │  • Личный кабинет       │   │  • Редактирование БД     ││
│   │  • Базовая админка      │   │                           ││
│   └───────────┬──────────────┘   └─────────────┬─────────────┘│
│               │                                 │              │
│               └────────────┬────────────────────┘              │
│                            │                                   │
│                   ┌────────▼────────┐                          │
│                   │   database.db   │                          │
│                   └─────────────────┘                          │
└──────────────────────────────────────────────────────────────┘
                             │
                             │ 2FA верификация
                             ▼
                   ┌─────────────────────┐
                   │   @syndver_bot      │
                   │   (Telegram)        │
                   │                     │
                   │  • Выдача кодов    │
                   │  • Управление      │
                   │    администраторами │
                   └─────────────────────┘
```

---

## ❓ FAQ

<details>
<summary><b>Порт 8080 или 5000 уже занят. Что делать?</b></summary>

**Windows:**
```cmd
netstat -ano | findstr :8080
taskkill /PID <номер_процесса> /F
```

**Linux:**
```bash
lsof -i :8080
kill -9 <PID>
```

Повторите для порта 5000, если необходимо.
</details>

<details>
<summary><b>Linux: pip install -r requirements.txt выдаёт ошибку</b></summary>

Попробуйте следующие варианты:

```bash
# Вариант 1: используйте pip3
pip3 install -r requirements.txt

# Вариант 2: установите пакеты вручную
pip3 install flask
pip3 install flask-socketio
pip3 install python-telegram-bot
# ... остальные пакеты из requirements.txt

# Вариант 3: используйте виртуальное окружение
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```
</details>

<details>
<summary><b>Linux: не установлена переменная MAIN_ADMIN_TG_ID</b></summary>

Если переменная окружения не установлена, сервер запустится с **ID по умолчанию**. В этом случае функции суперадмина в Telegram-боте будут недоступны или привязаны к тестовому аккаунту. Обязательно укажите свой Telegram ID:

```bash
export MAIN_ADMIN_TG_ID=123456789
python3 launcher.py
```
</details>

<details>
<summary><b>Бот @syndver_bot не отвечает</b></summary>

1. Убедитесь, что сервер запущен и работает
2. Проверьте интернет-соединение
3. Убедитесь, что переменная `MAIN_ADMIN_TG_ID` установлена корректно
4. Перезапустите сервер
</details>

<details>
<summary><b>Забыл 4-значный код</b></summary>

Войдите в бота с аккаунта суперадмина и просмотрите список зарегистрированных администраторов — там будут указаны их идентификаторы.
</details>

<details>
<summary><b>16-значный код не принимается</b></summary>

- Код **одноразовый** — если вы его уже использовали, получите новый через бота
- Проверьте, что вводите код без пробелов
- Убедитесь, что код не истёк (время жизни ограничено)
</details>

<details>
<summary><b>Как сбросить базу данных?</b></summary>

Удалите файл `database.db` и перезапустите сервер — будет создана новая пустая база данных. Тестовые данные (`admin@edu.ru`) будут восстановлены автоматически.
</details>

<details>
<summary><b>Как создать марафон или турнир?</b></summary>

1. Войдите в панель администратора на `http://localhost:8080`
2. Перейдите в раздел **«Марафоны и турниры»**
3. Нажмите **«Добавить событие»** в верхнем правом углу
4. Заполните форму и нажмите **«Создать событие»**
</details>

<details>
<summary><b>Можно ли запустить на другом порту?</b></summary>

В текущей версии порты 8080 и 5000 заданы по умолчанию и не настраиваются через переменные окружения.
</details>

---

## 🔑 Краткая памятка

```
📧 Тестовый email:      admin@edu.ru
🔒 Тестовый пароль:     admin123
👤 Тестовый никнейм:    Admin

🌐 Сайт олимпиады:      http://localhost:8080
🔧 Расширенная панель:  http://localhost:5000

🤖 Telegram-бот:        @syndver_bot
🆔 Узнать свой TG ID:   @funstat или @syndver_bot

⚙️  Переменная окружения: MAIN_ADMIN_TG_ID=ваш_telegram_id
```

---

## 📄 Лицензия

Этот проект распространяется под лицензией MIT. Подробности в файле [LICENSE](LICENSE).

---

<p align="center">
  <b>Сделано с ❤️ для олимпиадного сообщества</b>
</p>
